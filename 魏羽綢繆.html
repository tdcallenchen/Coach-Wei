<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>魏羽綢繆</title>
<style>
:root {
  --bg-light: #F0F4F8;  /* 背景淡藍白 */
  --bg-dark: #D9E2EC;   /* 漸層深藍灰 */
  --accent: #3B4A6B;    /* 標題 / 邊框色 */
  --dark: #1E2A38;      /* 文字深色 */
  --light: #ffffff;      /* 白色文字 */

  /* 球員等級顏色：同色系漸層 */
  --S: #2E4057;   /* 高階：深藍灰 */
  --A: #4A5E7A;   /* 中高階：藍灰 */
  --B: #6A7B9A;   /* 中階：中藍灰 */
  --C: #95A4B8;   /* 中初階：淺藍灰 */
  --D: #CBD4E0;   /* 初階：淡灰藍 */
}

body {
  font-family: 'Segoe UI', sans-serif;
  font-size: 16px;
  margin: 0; padding: 20px;
  background: linear-gradient(135deg, var(--bg-light), var(--bg-dark));
}

h1 { 
  text-align: center; 
  color: var(--accent); 
  font-size: 28px; 
  font-weight: bold;
  margin-bottom: 15px;
}

#controls { text-align: center; margin: 15px 0; }
#controls input, #controls select, #controls button { padding: 8px; margin: 4px; font-size: 15px; }

button { 
  border: none; 
  border-radius: 12px; 
  background-color: var(--accent); 
  color: var(--light); 
  cursor: pointer; 
  font-weight: bold; 
  transition:0.3s;
}
button:hover { background-color:#1E2A38; }

.container {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
}

/* 左側休息區 */
#bench {
  flex: 1 1 200px;
  min-width: 200px;
  background: var(--light);
  border: 3px solid var(--accent);
  border-radius: 20px;
  padding: 10px;
  display: flex; flex-direction: column;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
#bench h3 { color: var(--accent); text-align:center; margin:8px 0; font-weight:bold; }
.player-zone { flex-grow:1; overflow-y:auto; }

/* 右側場地 + 等候區 */
.right-side {
  flex: 3 1 600px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.row { display:flex; gap: 15px; }

.area {
  flex: 1 1 0;  /* 平均分配寬度 */
  min-width: 150px;
  background: var(--light);
  border:3px solid var(--accent);
  border-radius:20px;
  padding:10px;
  display:flex;
  flex-direction:column;
  min-height: 200px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.area h3 { color: var(--accent); text-align:center; margin:6px 0; font-weight:bold; }
.area-controls { text-align:center; margin-top:6px; }
.timer { font-size:14px; color:var(--dark); margin-left:6px; }

/* 球員 */
.player { 
  position: relative;
  padding: 8px 10px;
  margin: 6px 0;
  border-radius:10px;
  font-weight:bold;
  text-align:center;
  cursor:grab;
}
.player.高階{background:var(--S); color:var(--light);}
.player.中高階{background:var(--A); color:var(--light);}
.player.中階{background:var(--B); color:var(--light);}
.player.中初階{background:var(--C); color:var(--dark);}
.player.初階{background:var(--D); color:var(--dark);}

/* 手機自適應 */
@media (max-width:768px){
  .container{flex-direction:column;}
  .row{flex-direction:column;}
  #bench{width:100%;height:auto;}
  .area{width:100%; min-height:auto;}
}
</style>
</head>
<body>
<h1>魏羽綢繆</h1>

<div id="controls">
  <input type="text" id="newPlayer" placeholder="輸入球員名稱">
  <select id="playerLevel">
    <option value="高階">高階</option>
    <option value="中高階">中高階</option>
    <option value="中階">中階</option>
    <option value="中初階">中初階</option>
    <option value="初階">初階</option>
  </select>
  <button onclick="addPlayer()">新增球員</button>
  <button onclick="resetAll()">重置</button>
</div>

<div class="container">
  <div id="bench">
    <h3>休息區</h3>
    <div class="player-zone" id="bench-zone"></div>
  </div>

  <div class="right-side">
    <div class="row">
      <div class="area" id="court1">
        <h3>場地1 <span class="timer" id="court1-timer">⏱ 00:00</span></h3>
        <div class="player-zone" id="court1-zone"></div>
        <div class="area-controls"><button onclick="endMatch('court1')">結束比賽</button></div>
      </div>
      <div class="area" id="court2">
        <h3>場地2 <span class="timer" id="court2-timer">⏱ 00:00</span></h3>
        <div class="player-zone" id="court2-zone"></div>
        <div class="area-controls"><button onclick="endMatch('court2')">結束比賽</button></div>
      </div>
      <div class="area" id="court3">
        <h3>場地3 <span class="timer" id="court3-timer">⏱ 00:00</span></h3>
        <div class="player-zone" id="court3-zone"></div>
        <div class="area-controls"><button onclick="endMatch('court3')">結束比賽</button></div>
      </div>
      <div class="area" id="court4">
        <h3>場地4 <span class="timer" id="court4-timer">⏱ 00:00</span></h3>
        <div class="player-zone" id="court4-zone"></div>
        <div class="area-controls"><button onclick="endMatch('court4')">結束比賽</button></div>
      </div>
    </div>

    <div class="row">
      <div class="area">
        <h3>等待區1</h3>
        <div class="player-zone" id="waitingA-zone"></div>
      </div>
      <div class="area">
        <h3>等待區2</h3>
        <div class="player-zone" id="waitingB-zone"></div>
      </div>
      <div class="area">
        <h3>等待區3</h3>
        <div class="player-zone" id="waitingC-zone"></div>
      </div>
      <div class="area">
        <h3>等待區4</h3>
        <div class="player-zone" id="waitingD-zone"></div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
const maxPlayersPerArea = 4;
const areaIds = [
  'bench-zone',
  'court1-zone','court2-zone','court3-zone','court4-zone',
  'waitingA-zone','waitingB-zone','waitingC-zone','waitingD-zone'
];

let courtTimers = {
  court1:{interval:null, seconds:0},
  court2:{interval:null, seconds:0},
  court3:{interval:null, seconds:0},
  court4:{interval:null, seconds:0}
};

function formatTime(sec){
  let m=String(Math.floor(sec/60)).padStart(2,'0'); 
  let s=String(sec%60).padStart(2,'0'); 
  return m+':'+s; 
}

function startTimer(courtId){
  if(courtTimers[courtId].interval) return;
  courtTimers[courtId].interval=setInterval(()=>{
    courtTimers[courtId].seconds++;
    document.getElementById(courtId+'-timer').textContent='⏱ '+formatTime(courtTimers[courtId].seconds);
  },1000);
}

function stopTimer(courtId){
  clearInterval(courtTimers[courtId].interval);
  courtTimers[courtId].interval=null;
  courtTimers[courtId].seconds=0;
  document.getElementById(courtId+'-timer').textContent='⏱ 00:00';
}

function addPlayer(){
  const name=document.getElementById('newPlayer').value.trim();
  const level=document.getElementById('playerLevel').value;
  if(!name) return;
  const div=document.createElement('div');
  div.className='player '+level;
  div.textContent=name;
  document.getElementById('bench-zone').appendChild(div);
  document.getElementById('newPlayer').value='';
}

function endMatch(courtId){
  const courtZone=document.getElementById(courtId+'-zone');
  const benchZone=document.getElementById('bench-zone');
  const waitingZones=[
    document.getElementById('waitingA-zone'),
    document.getElementById('waitingB-zone'),
    document.getElementById('waitingC-zone'),
    document.getElementById('waitingD-zone')
  ];

  [...courtZone.querySelectorAll('.player')].forEach(p=>benchZone.appendChild(p));
  stopTimer(courtId);

  for(let wz of waitingZones){
    while(courtZone.querySelectorAll('.player').length < maxPlayersPerArea){
      let next = wz.querySelector('.player');
      if(!next) break;
      courtZone.appendChild(next);
    }
    if(courtZone.querySelectorAll('.player').length > 0){
      startTimer(courtId);
    }
  }

  for(let i=0;i<waitingZones.length-1;i++){
    while(waitingZones[i].querySelectorAll('.player').length < maxPlayersPerArea){
      let next = waitingZones[i+1].querySelector('.player');
      if(!next) break;
      waitingZones[i].appendChild(next);
    }
  }
}

function resetAll(){ location.reload(); }

areaIds.forEach(id=>{
  Sortable.create(document.getElementById(id),{
    group:'players',
    animation:150,
    onAdd: evt=>{
      const to=evt.to;
      if(to.querySelectorAll('.player').length>maxPlayersPerArea && to.id!=='bench-zone'){
        evt.from.insertBefore(evt.item, evt.from.children[evt.oldIndex]);
        alert('此區最多只能容納4人');
      } else {
        if(to.id.includes("court") && to.querySelectorAll('.player').length === 1){
          let courtId = to.id.replace("-zone","");
          startTimer(courtId);
        }
      }
    }
  });
});

document.getElementById('newPlayer').addEventListener('keypress', e=>{
  if(e.key==='Enter') addPlayer();
});
</script>
</body>
</html>
